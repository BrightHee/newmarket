<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <div th:include="fragments.html :: head" th:remove="tag"></div>
    <link rel="stylesheet" href="/node_modules/summernote/dist/summernote-bs4.min.css" />
    <style>
        .container {
            max-width: 100%;
        }
    </style>
</head>

<body>

<nav th:replace="fragments.html :: main-nav"></nav>

<div class="container my-3">
    <div th:replace="fragments.html :: error-message"></div>
    <div th:replace="fragments.html :: success-message"></div>
    <div th:replace="fragments.html :: garment-menu(currentMenu = 'registration')"></div>
    <div class="bg-light border-dark p-5">
        <div class="row justify-content-center">
            <div class="col-sm-6">
                <div th:replace="fragments.html :: image-editor(header = '옷 이미지', type = 'garmentForm')"></div>
            </div>
        </div>
        <div class="row justify-content-center">
            <div class="col-sm-8 p-4">
                <form class="needs-validation" th:object="${garmentForm}" th:action="@{/new-garment}" method="post" novalidate>
                    <div class="row form-group mt-4">
                        <div class="col-sm-10">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text"> 글 제목 </span>
                                </div>
                                <input th:field="*{title}" class="form-control" name="title" type="text"
                                       placeholder="글 제목을 입력하세요." minlength="1" max="80" required />
                                <small class="invalid-feedback">제목을 알맞게 입력하세요.</small>
                            </div>
                            <small th:if="${#fields.hasErrors('title')}" th:errors="*{title}" class="form-text text-danger">잘못된 제목</small>
                            <small class="form-text text-muted">
                                제목은 필수입니다. 80자 이내로 간단하게 입력해주세요.
                            </small>
                        </div>
                    </div>
                    <div class="row form-group mt-4">
                        <div class="col-sm-6">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text"> 종류 </span>
                                </div>
                                <select th:field="*{type}" class="browser-default custom-select" name="type" required>
                                    <option value="" selected hidden>선택하세요</option>
                                    <option th:each="g : ${garmentType}" th:value="${g}" th:text="${g}"></option>
                                </select>
                                <small class="invalid-feedback">종류를 선택하세요.</small>
                            </div>
                            <small th:if="${#fields.hasErrors('type')}" th:errors="*{type}" class="form-text text-danger">잘못된 타입</small>
                            <small class="form-text text-muted">
                                옷에 해당하는 종류를 선택해주세요. 종류별로 옷을 볼 수 있습니다.
                            </small>
                        </div>
                    </div>
                    <div class="row form-group mt-4">
                        <div class="col-sm-6">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text"> 희망 가격 </span>
                                </div>
                                <input th:field="*{price}" class="form-control" name="price" type="number"
                                       placeholder="희망하는 가격을 입력하세요." min="0" required />
                                <div class="input-group-append">
                                    <span class="input-group-text"> 원 </span>
                                </div>
                                <small class="invalid-feedback">가격을 알맞게 입력하세요.</small>
                            </div>
                            <small th:if="${#fields.hasErrors('price')}" th:errors="*{price}" class="form-text text-danger">잘못된 가격</small>
                            <small class="form-text text-muted">
                                팔기 원하는 가격을 입력해주세요.
                            </small>
                        </div>
                    </div>
                    <div class="row form-group mt-4">
                        <div class="col-sm-3">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text"> 시/도 </span>
                                </div>
                                <select th:field="*{cityProvince}" name="cityProvince" id="cityProvince"
                                        class="browser-default custom-select" required>
                                    <option value="" selected hidden>선택하세요</option>
                                    <option th:each="cp : ${cityProvinceList}" th:value="${cp}" th:text="${cp}"></option>
                                </select>
                                <small class="invalid-feedback">시/도를 선택하세요.</small>
                            </div>
                            <small th:if="${#fields.hasErrors('cityProvince')}" th:errors="*{cityProvince}" class="form-text text-danger">잘못된 지역</small>
                            <small class="form-text text-muted">
                                거래를 할 지역을 선택하세요.
                            </small>
                        </div>
                        <div class="col-sm-3">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text"> 시/군/구 </span>
                                </div>
                                <select th:field="*{cityCountryDistrict}" name="cityCountryDistrict" id="cityCountryDistrict"
                                        class="browser-default custom-select" required>
                                    <option value="" selected hidden>선택하세요</option>
                                </select>
                                <small class="invalid-feedback">시/군/구를 선택하세요.</small>
                            </div>
                        </div>
                        <div class="col-sm-3">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text"> 읍/면/동 </span>
                                </div>
                                <select th:field="*{townTownshipNeighborhood}" name="townTownshipNeighborhood" id="townTownshipNeighborhood"
                                        class="browser-default custom-select" required>
                                    <option value="" selected hidden>선택하세요</option>
                                </select>
                                <small class="invalid-feedback">시/도를 선택하세요.</small>
                            </div>
                        </div>
                    </div>
                    <div class="row form-group mt-4">
                        <div class="col-12">
                            <textarea th:field="*{content}" class="form-control editor" name="content" type="textarea"></textarea>
                        </div>
                    </div>
                    <div class="form-group">
                        <input th:field="*{image}" id="garmentImage" class="form-control" type="hidden" />
                    </div>
                    <div class="row justify-content-between form-group mt-4 mb-0">
                        <div class="col-sm-4">
                            <button type="submit" class="btn btn-primary btn-block"> 등록하기 </button>
                        </div>
                        <div class="col-sm-2">
                            <button type="reset" class="btn btn-danger btn-block"> 취소 </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<footer th:replace="fragments.html :: main-footer"></footer>

<script th:replace="fragments.html :: form-validation"></script>
<script th:include="fragments.html :: editor-script" th:remove="tag"></script>
<script th:include="fragments.html :: image-cropper(imageId = 'garmentImage')" th:remove="tag"></script>
<script th:replace="fragments.html :: ajax-csrf-token"></script>

<script type="application/javascript">
    $(function () {
        let $cityProvince = $("#cityProvince");
        let $cityCountryDistrict = $('#cityCountryDistrict');
        let $townTownshipNeighborhood = $('#townTownshipNeighborhood');

        $cityProvince.change(function() {
            $.ajax({
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                method: "POST",
                url: "/new-garment/cityCountryDistrict",
                data: JSON.stringify({ 'cityProvince': $cityProvince.val() })
            }).done(function (data, status) {
                if (data !== null) {
                    $cityCountryDistrict.html('');
                    $townTownshipNeighborhood.html('');
                    $('<option>').attr({
                        selected: true,
                        hidden: true,
                        value: ''
                    }).text('선택하세요').appendTo($cityCountryDistrict);
                    $('<option>').attr({
                        selected: true,
                        hidden: true,
                        value: ''
                    }).text('선택하세요').appendTo($townTownshipNeighborhood);
                }
                $.each(data, function (idx, el) {
                    $cityCountryDistrict.append(new Option(el, el));
                });
            });
        });

        $cityCountryDistrict.change(function () {
            $.ajax({
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                method: "POST",
                url: "/new-garment/townTownshipNeighborhood",
                data: JSON.stringify({
                    'cityProvince': $cityProvince.val(),
                    'cityCountryDistrict': $cityCountryDistrict.val()
                })
            }).done(function (data, status) {
                if (data !== null) {
                    $townTownshipNeighborhood.html('');
                    $('<option>').attr({
                        selected: true,
                        hidden: true,
                        value: ''
                    }).text('선택하세요').appendTo($townTownshipNeighborhood);
                }
                $.each(data, function (idx, el) {
                    $townTownshipNeighborhood.append(new Option(el, el));
                });
            });
        });
    });
</script>

</body>
</html>